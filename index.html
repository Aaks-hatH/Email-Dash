<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureScan V6 | Enterprise Email Intelligence & ML Analysis</title>
    
    <!-- Professional Metadata & Assets -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ°Ô∏è</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Core Scripts -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        :root {
            --pjs: 'Plus Jakarta Sans', sans-serif;
            --mono: 'JetBrains Mono', monospace;

            /* Grayscale Core - Titanium Aesthetic */
            --white: #ffffff;
            --zinc-50: #fafafa;
            --zinc-100: #f4f4f5;
            --zinc-200: #e4e4e7;
            --zinc-500: #71717a;
            --zinc-900: #18181b;
            --zinc-950: #09090b;

            /* Status Colors */
            --accent-safe: #10b981;
            --accent-warn: #f59e0b;
            --accent-danger: #ef4444;
            --accent-info: #3b82f6;

            --nav-height: 80px;
            --sidebar-width: 300px;
            --border-radius-lg: 24px;
            --border-radius-md: 12px;

            --glass: rgba(255, 255, 255, 0.7);
            --border-titanium: 1px solid rgba(0, 0, 0, 0.08);
            --transition-hq: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background-color: var(--zinc-50);
            color: var(--zinc-900);
            font-family: var(--pjs);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Subtle Grain Texture Overlay */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            opacity: 0.015;
            pointer-events: none;
            z-index: 10000;
        }

        /* --- Layout: Navigation --- */
        nav {
            position: fixed;
            top: 0; width: 100%; height: var(--nav-height);
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-bottom: var(--border-titanium);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 60px;
            z-index: 2000;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 14px;
            font-weight: 800;
            font-size: 1.25rem;
            cursor: pointer;
        }

        .brand-icon {
            width: 38px; height: 38px;
            background: var(--zinc-950);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .nav-links {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--zinc-500);
            font-size: 0.9rem;
            font-weight: 600;
            transition: var(--transition-hq);
        }

        .nav-link:hover, .nav-link.active { color: var(--zinc-950); }

        /* --- Global Component Styles --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 24px;
            border-radius: var(--border-radius-md);
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition-hq);
            border: 1px solid transparent;
        }

        .btn-black { background: var(--zinc-950); color: white; }
        .btn-black:hover { transform: translateY(-2px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .btn-outline { border: 1px solid var(--zinc-200); background: white; color: var(--zinc-900); }

        /* --- Page Router Styling --- */
        .page {
            display: none;
            min-height: 100vh;
            padding: calc(var(--nav-height) + 40px) 60px 60px;
            opacity: 0;
            transform: translateY(10px);
        }

        .page.active { display: block; opacity: 1; transform: translateY(0); transition: 0.6s ease-out; }

        /* --- PAGE: Home --- */
        .hero {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
            padding: 80px 0;
        }

        .hero h1 {
            font-size: 5rem;
            font-weight: 800;
            letter-spacing: -3px;
            line-height: 1;
            margin-bottom: 24px;
        }

        .hero p {
            font-size: 1.4rem;
            color: var(--zinc-500);
            max-width: 750px;
            margin: 0 auto 48px;
        }

        /* --- PAGE: Analyzer --- */
        .workspace-layout {
            display: grid;
            grid-template-columns: var(--sidebar-width) 1fr 380px;
            gap: 24px;
            height: calc(100vh - 200px);
        }

        .panel {
            background: var(--white);
            border: var(--border-titanium);
            border-radius: var(--border-radius-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.02);
        }

        .panel-header {
            padding: 20px 24px;
            border-bottom: var(--border-titanium);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--zinc-50);
        }

        .tool-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            color: var(--zinc-500);
        }

        .tool-item:hover { background: var(--zinc-100); color: var(--zinc-950); }

        .input-control {
            width: 100%;
            padding: 16px;
            background: var(--zinc-50);
            border: 1px solid var(--zinc-200);
            border-radius: 12px;
            margin-bottom: 20px;
            outline: none;
            font-family: inherit;
        }

        /* Terminal View */
        .terminal {
            background: var(--zinc-950);
            color: var(--accent-safe);
            padding: 20px;
            font-family: var(--mono);
            font-size: 0.75rem;
            height: 200px;
            overflow-y: auto;
        }

        /* --- PAGE: Intelligence --- */
        .intel-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            max-width: 1200px;
            margin: 0 auto 40px;
        }

        .intel-stat-card {
            background: white;
            border: var(--border-titanium);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
        }

        .intel-stat-card h2 { font-size: 3rem; font-weight: 800; }
        .intel-stat-card p { font-size: 0.8rem; font-weight: 700; color: var(--zinc-400); text-transform: uppercase; }

        .intel-map-box {
            background: #f1f5f9;
            height: 500px;
            border-radius: 30px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-titanium);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-ping {
            position: absolute;
            width: 15px; height: 15px;
            background: var(--accent-danger);
            border-radius: 50%;
            animation: ping 2s infinite;
        }

        @keyframes ping {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(4); opacity: 0; }
        }

        /* --- ADMIN MODAL --- */
        .modal-backdrop {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(9, 9, 11, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .admin-modal {
            background: white;
            padding: 40px;
            border-radius: 30px;
            width: 450px;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }

        .admin-modal h2 { margin-bottom: 10px; font-weight: 800; }
        .admin-modal p { color: var(--zinc-500); font-size: 0.9rem; margin-bottom: 25px; }

    </style>
</head>
<body>

    <nav>
        <div class="brand" onclick="router.navigate('home')">
            <div class="brand-icon"><i data-lucide="shield-check"></i></div>
            SECURESCAN <span style="font-weight: 300; opacity: 0.4; margin-left: 5px;">V6.0</span>
        </div>
        <div class="nav-links">
            <a href="javascript:void(0)" class="nav-link" id="l-home" onclick="router.navigate('home')">Overview</a>
            <a href="javascript:void(0)" class="nav-link" id="l-analyzer" onclick="router.navigate('analyzer')">Analyzer</a>
            <a href="javascript:void(0)" class="nav-link" id="l-intel" onclick="router.navigate('intel')">Intelligence</a>
            <a href="javascript:void(0)" class="nav-link" onclick="openAdminModal()">Admin</a>
        </div>
        <button class="btn btn-black" onclick="router.navigate('analyzer')">Launch Console</button>
    </nav>

    <!-- PAGE: HOME -->
    <section id="page-home" class="page">
        <div class="hero">
            <div style="background: var(--zinc-100); display: inline-block; padding: 6px 15px; border-radius: 100px; font-size: 0.7rem; font-weight: 800; margin-bottom: 20px;">V6.0 ENTERPRISE CORE</div>
            <h1>Next-Gen Intelligence <br>for Email Defense.</h1>
            <p>High-fidelity heuristic analysis mapping over 50,000 global threat vectors in real-time to neutralize phishing before it hits the inbox.</p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-black" onclick="router.navigate('analyzer')">Start Analyzing <i data-lucide="zap"></i></button>
                <button class="btn btn-outline" onclick="router.navigate('intel')">View Global Intel</button>
            </div>
        </div>
    </section>

    <!-- PAGE: ANALYZER -->
    <section id="page-analyzer" class="page">
        <div class="workspace-layout">
            <aside class="panel">
                <div class="panel-header"><h3>Simulations</h3></div>
                <div class="tool-item" onclick="analyzer.load('phish')"><i data-lucide="alert-triangle"></i> Phishing Credential</div>
                <div class="tool-item" onclick="analyzer.load('invoice')"><i data-lucide="file-text"></i> Invoice Fraud (BEC)</div>
                <div class="tool-item" onclick="analyzer.load('prize')"><i data-lucide="gift"></i> Lottery Scam</div>
            </aside>

            <main class="panel">
                <div class="panel-header"><h3>AI Analysis Engine</h3></div>
                <div style="padding: 24px; flex: 1; overflow-y: auto;">
                    <form onsubmit="analyzer.run(event)">
                        <input type="text" id="s-sender" class="input-control" placeholder="Sender Identity (e.g. security@paypal.com)">
                        <input type="text" id="s-subject" class="input-control" placeholder="Subject Line">
                        <textarea id="s-body" class="input-control" style="height: 150px; resize: none;" placeholder="Paste raw email body here..."></textarea>
                        <button type="submit" class="btn btn-black" style="width: 100%; height: 55px;" id="runBtn">Execute Deep Scan</button>
                    </form>
                </div>
                <div class="terminal" id="term">Awaiting system payload...</div>
            </main>

            <aside class="panel" id="resList">
                <div class="panel-header"><h3>Security Verdicts</h3></div>
                <div style="padding: 24px; text-align: center; color: var(--zinc-400);" id="emptyRes">
                    <i data-lucide="activity" size="40" style="margin-bottom: 10px; opacity: 0.2;"></i>
                    <p>Analysis output will appear here.</p>
                </div>
            </aside>
        </div>
    </section>

    <!-- PAGE: INTELLIGENCE -->
    <section id="page-intel" class="page">
        <div class="intel-grid">
            <div class="intel-stat-card"><h2 id="i-tracked">--</h2><p>Tracked IPs</p></div>
            <div class="intel-stat-card"><h2 id="i-blocked" style="color: var(--accent-danger)">--</h2><p>Blocked Nodes</p></div>
            <div class="intel-stat-card"><h2 id="i-rep">--</h2><p>Avg Reputation</p></div>
        </div>
        <div class="intel-map-box" id="mapBox">
            <div style="position: absolute; opacity: 0.05; font-size: 8rem; font-weight: 900;">THREAT NETWORK</div>
        </div>
    </section>

    <!-- ADMIN MODAL -->
    <div class="modal-backdrop" id="adminModal">
        <div class="admin-modal">
            <div style="background: var(--zinc-950); color: white; width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;"><i data-lucide="lock" size="30"></i></div>
            <h2>Admin Authorization</h2>
            <p>Enter your V6 Admin Key to access the command center. This will redirect you to the admin dashboard.</p>
            <input type="password" id="modalKey" class="input-control" placeholder="Enter X-API-KEY" style="background: #f4f4f5; text-align: center;">
            <button class="btn btn-black" style="width: 100%;" onclick="validateAdmin()">Verify & Enter</button>
            <button class="btn btn-outline" style="width: 100%; margin-top: 10px; border: none;" onclick="closeAdminModal()">Cancel</button>
        </div>
    </div>

    <script>
        lucide.createIcons();
        const API_URL = 'https://email-security-api.onrender.com';

        // --- Router ---
        const router = {
            navigate(pageId) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                
                document.getElementById('page-' + pageId).classList.add('active');
                if(document.getElementById('l-' + pageId)) document.getElementById('l-' + pageId).classList.add('active');
                
                if(pageId === 'intel') intel.fetch();
                window.scrollTo(0,0);
            }
        };

        // --- Intelligence Logic ---
        const intel = {
            async fetch() {
                try {
                    const res = await fetch(`${API_URL}/api/analysis/stats`);
                    const data = await res.json();
                    if(data.success) {
                        document.getElementById('i-tracked').innerText = data.ipReputation.trackedIPs;
                        document.getElementById('i-blocked').innerText = data.ipReputation.blockedIPs;
                        document.getElementById('i-rep').innerText = data.ipReputation.averageReputationScore + '%';
                        this.spawnPings();
                    }
                } catch(e) { console.error("Intel Error"); }
            },
            spawnPings() {
                const box = document.getElementById('mapBox');
                for(let i=0; i<6; i++) {
                    const p = document.createElement('div');
                    p.className = 'map-ping';
                    p.style.top = Math.random() * 80 + 10 + '%';
                    p.style.left = Math.random() * 80 + 10 + '%';
                    box.appendChild(p);
                    setTimeout(() => p.remove(), 2000);
                }
            }
        };

        // --- Analyzer Logic ---
        const analyzer = {
            load(type) {
                const map = {
                    phish: {s: 'security@microsoft-verify.com', sub: 'Urgent: Account Access Suspended', b: 'Verify your ID now: http://fake-login.xyz'},
                    invoice: {s: 'billing@intuit-services.com', sub: 'Invoice #99281 Overdue', b: 'Please pay $1,200 immediately.'},
                    prize: {s: 'claims@lottery-intl.org', sub: 'YOU WON $1,000,000', b: 'Send bank info to claim.'}
                };
                document.getElementById('s-sender').value = map[type].s;
                document.getElementById('s-subject').value = map[type].sub;
                document.getElementById('s-body').value = map[type].b;
            },
            async run(e) {
                e.preventDefault();
                const btn = document.getElementById('runBtn');
                btn.disabled = true; btn.innerText = "Analyzing Threat Vectors...";
                document.getElementById('term').innerHTML = `[${new Date().toLocaleTimeString()}] INITIATING ML SCAN...`;

                try {
                    const res = await fetch(`${API_URL}/api/analysis/analyze`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ email: { from: document.getElementById('s-sender').value, subject: document.getElementById('s-subject').value, body: document.getElementById('s-body').value, links: [] }})
                    });
                    const data = await res.json();
                    if(data.success) this.render(data.analysis);
                } catch(e) { document.getElementById('term').innerText = "CONNECTION FAILED."; }
                finally { btn.disabled = false; btn.innerText = "Execute Deep Scan"; }
            },
            render(a) {
                document.getElementById('emptyRes').style.display = 'none';
                const card = document.createElement('div');
                card.style.padding = '20px';
                card.style.borderBottom = '1px solid var(--zinc-100)';
                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span style="font-weight:800; color:${a.riskLevel==='High'?'var(--accent-danger)':'var(--accent-safe)'}">${a.riskLevel} Risk</span>
                        <span style="font-weight:800;">Score: ${a.riskScore}</span>
                    </div>
                    <p style="font-size:0.8rem; color:var(--zinc-500);">${a.summary.keyPoints[0]}</p>
                `;
                document.getElementById('resList').appendChild(card);
            }
        };

        // --- Admin Integration ---
        function openAdminModal() { document.getElementById('adminModal').style.display = 'flex'; }
        function closeAdminModal() { document.getElementById('adminModal').style.display = 'none'; }

        async function validateAdmin() {
            const key = document.getElementById('modalKey').value;
            if(!key) return;

            // Attempt to verify key against your admin endpoint
            try {
                const res = await fetch(`${API_URL}/api/admin/security-stats`, {
                    headers: { 'X-API-Key': key }
                });

                if(res.ok) {
                    // STORE KEY IN SESSIONSTORAGE (Your admin.html looks for this)
                    sessionStorage.setItem('adminKey', key);
                    // REDIRECT TO YOUR ADMIN.HTML
                    window.location.href = 'admin.html';
                } else {
                    alert("Authorization Failed: Invalid Admin Key.");
                }
            } catch(e) {
                alert("Server Connection Error.");
            }
        }

        router.navigate('home');
    </script>
</body>
</html>
